---
title: 1.3.0 Upgrade Notice
weight: 2
description: Migrating from Gloo 1.2 to Gloo Enterprise 1.3.0 (~Gloo open-source 1.3.16) 
---

### Recommended helm settings

Set EDS warm timeout to nonzero (recommended 5 minutes):
```shell script
kubectl patch settings -n gloo-system default \
    --patch '{"spec": {"gloo": {"endpointsWarmingTimeout": "5m"}}}' --type=merge
```

No longer necessary as the default changes to five minutes in 1.3.16.

Set helm readiness and liveness probes as well during upgrade. These can be set on the upgrade command itself.

If not using kube LB, then https://docs.solo.io/gloo/latest/guides/traffic_management/request_processing/health_checks/

### Setup to test downtime

install gloo:
```shell script
glooctl install gateway
```

add an upstream:
```shell script
apiVersion: gloo.solo.io/v1
kind: Upstream
metadata:
  name: json-upstream
  namespace: gloo-system
spec:
  static:
    hosts:
      - addr: jsonplaceholder.typicode.com
        port: 80
```

and make it routable:
```shell script
apiVersion: gateway.solo.io/v1
kind: VirtualService
metadata:
  name: test-prefix
  namespace: gloo-system
spec:
  virtualHost:
    routes:
      - matchers:
         - prefix: /posts
        routeAction:
          single:
            upstream:
              name: json-upstream
              namespace: gloo-system
        options:
          autoHostRewrite: true
```

wait until the following returns:
```shell script
curl $(glooctl proxy url)/posts
```

then

upgrade to open-source:
```shell script
hey -n 5000 $(glooctl proxy url)/posts & helm upgrade gloo gloo/gloo --namespace gloo-system \
    --set gatewayProxies.gatewayProxy.podTemplate.probes=true --version 1.3.15
```
upgrade to closed-source:
```shell script
hey -n 5000 $(glooctl proxy url)/posts & helm upgrade gloo glooe/gloo-ee --namespace gloo-system \
    --set gloo.gatewayProxies.gatewayProxy.podTemplate.probes=true --version=1.3.0-beta5
```

and wait for the request distribution at the end to confirm that requests weren't dropped.


### Gotchas

#### Open-Source

1.2.x, need the following helm override to go to 1.3.0+:
```shell script
helm upgrade -n gloo-system gloo gloo/gloo --version=v1.3.15 --set gatewayProxies.gatewayProxy.gatewaySettings.disableGeneratedGateways=true
```
Replacing `gatewayProxy` with the name of each proxy you already have deployed.


From this point onward, the helm release will be fine and use the values saved from above. No need for all the scale down stuff.

#### Enterprise

```shell script
kg pvc -n gloo-system
```
returns
```shell script
NAME                      STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
glooe-grafana             Bound    pvc-faa38812-ab36-4be5-972d-943b39edec94   100Mi      RWO            standard       12m
glooe-prometheus-server   Bound    pvc-6b710147-ca76-4cac-9e0b-f022712a66d2   16Gi       RWO            standard       7m30s
```

1.3.0-beta6 or lower, you need the following helm override on the first try only?:
```shell script
helm upgrade gloo glooe/gloo-ee --namespace gloo-system --version=1.3.0-beta3 --set gloo.gatewayProxies.gatewayProxy.gatewaySettings.disableGeneratedGateways=true --set settings.create=false --set grafana.persistence.storageClassName=standard
```

In addition, going to 1.3.0
do we need this?
```
helm upgrade -n gloo-system gloo gloo/gloo --version=v1.3.15 --set gloo.gatewayProxies.gatewayProxy.gatewaySettings.disableGeneratedGateways=true
```
Replacing `gatewayProxy` with the name of each proxy you already have deployed.

TODO(kdorosh): make sure we handle the garbage collection of resources! add extra helm value to hooks for garbage collection?
TODO(kdorosh): helm 2 testing
TODO(kdorosh): downtime testing

### Open-Source to enterprise

Run the same helm commands as you would for enterprise. The release name is gloo in both cases, so your open source
gloo chart will be replaced by the gloo enterprise chart.